# Деплой на Netlify

## Подготовка проекта

1. **Убедитесь, что все зависимости установлены:**
```bash
npm install
```

2. **Создайте файл `.env` (если нужно):**
```bash
cp .env.example .env
# Отредактируйте .env и добавьте необходимые переменные окружения
```

## Загрузка на GitHub

1. **Инициализируйте Git репозиторий (если еще не сделано):**
```bash
git init
git add .
git commit -m "Initial commit: LR-CHIP website"
```

2. **Создайте репозиторий на GitHub:**
   - Перейдите на https://github.com
   - Создайте новый репозиторий (например, `lr-chip`)
   - Не добавляйте README, .gitignore или лицензию (они уже есть)

3. **Подключите локальный репозиторий к GitHub:**
```bash
git remote add origin https://github.com/YOUR_USERNAME/lr-chip.git
git branch -M main
git push -u origin main
```

## Деплой на Netlify

1. **Перейдите на Netlify:**
   - Зарегистрируйтесь/войдите на https://www.netlify.com
   - Нажмите "Add new site" → "Import an existing project"

2. **Подключите GitHub репозиторий:**
   - Выберите "GitHub" как провайдера
   - Авторизуйтесь через GitHub
   - Выберите репозиторий `lr-chip`

3. **Настройте сборку:**
   - **Build command:** `npm run build` (или оставьте пустым, так как указано в `netlify.toml`)
   - **Publish directory:** Оставьте пустым или установите `.next` (плагин Next.js автоматически определит)
   - Netlify автоматически использует `netlify.toml` для настроек
   - **Node version:** Убедитесь, что установлена версия 20 (указано в `netlify.toml`)

4. **Добавьте переменные окружения (ОБЯЗАТЕЛЬНО для безопасности):**
   - В настройках сайта → **Environment variables** → **Add a variable**
   
   **Обязательные переменные:**
   - **Key:** `ADMIN_PASSWORD`
   - **Value:** Ваш надежный пароль (например, `MySecurePassword123!`)
   - ⚠️ **ВАЖНО:** Если не добавить эту переменную, будет использоваться дефолтный пароль `admin123`, что небезопасно!
   
   **Переменные для Telegram уведомлений (опционально):**
   - **Key:** `TELEGRAM_BOT_TOKEN`
   - **Value:** Токен вашего Telegram бота (см. инструкцию ниже)
   - **Key:** `TELEGRAM_CHAT_ID`
   - **Value:** ID вашего Telegram чата (см. инструкцию ниже)
   
   - **Scopes:** Выберите "All scopes" или только "Production"
   - Нажмите **Save**
   - После добавления переменных перезапустите деплой (Deploys → Trigger deploy)

5. **Настройка хранения данных (Netlify Blobs):**
   - Проект использует **Netlify Blobs** для хранения данных админки (vehicles, services, orders)
   - Blobs автоматически доступны на Netlify - дополнительная настройка не требуется
   - Данные хранятся в облаке и доступны для записи/чтения
   - ⚠️ **ВАЖНО:** На Netlify файловая система доступна только для чтения, поэтому данные сохраняются в Blobs автоматически
   - Если при сохранении возникает ошибка "Failed to save", проверьте логи Netlify Functions (см. TROUBLESHOOTING.md)

6. **Запустите деплой:**
   - Нажмите "Deploy site"
   - Netlify автоматически соберет и задеплоит проект

## После деплоя

1. **Проверьте сайт:**
   - Netlify предоставит URL вида `https://random-name.netlify.app`
   - Можно настроить кастомный домен в настройках

2. **Настройте домен (опционально):**
   - В настройках сайта → Domain settings
   - Добавьте свой домен

## Настройка Telegram уведомлений

Для получения уведомлений о новых заказах в Telegram:

1. **Создайте Telegram бота:**
   - Откройте Telegram и найдите [@BotFather](https://t.me/botfather)
   - Отправьте команду `/newbot`
   - Следуйте инструкциям и создайте бота
   - Сохраните токен бота (выглядит как `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

2. **Получите Chat ID:**
   - Найдите вашего бота в Telegram и отправьте ему любое сообщение
   - Откройте в браузере: `https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates`
   - Найдите в ответе поле `"chat":{"id":123456789}` - это ваш Chat ID

3. **Добавьте переменные в Netlify:**
   - `TELEGRAM_BOT_TOKEN` - токен вашего бота
   - `TELEGRAM_CHAT_ID` - ваш Chat ID (только цифры)

4. **Проверьте работу:**
   - Создайте тестовый заказ на сайте
   - Вы должны получить уведомление в Telegram

⚠️ **Примечание:** Если переменные не настроены, уведомления просто не будут отправляться, но заказы будут сохраняться нормально.

## Важные замечания

- **Файлы данных:** Данные хранятся в `src/data/*.json`. Эти файлы будут в репозитории, но при деплое они будут пустыми. Для продакшена рекомендуется использовать базу данных.

- **Переменные окружения:** 
  - ⚠️ **ОБЯЗАТЕЛЬНО добавьте `ADMIN_PASSWORD` в Netlify Environment Variables!**
  - Без этой переменной админка будет использовать дефолтный пароль `admin123`, что небезопасно.
  - `TELEGRAM_BOT_TOKEN` и `TELEGRAM_CHAT_ID` - опциональные, для уведомлений о заказах
  - Не коммитьте `.env` файл в Git. Используйте `.env.example` как шаблон.
  - Переменные окружения в Netlify доступны только на сервере, не в браузере.

- **Netlify Functions:** Для API routes Next.js автоматически создает Netlify Functions. Все работает из коробки.

- **Безопасность админки:**
  - По умолчанию (без переменной окружения) пароль: `admin123`
  - После добавления `ADMIN_PASSWORD` в Netlify, используйте установленный пароль
  - Рекомендуется использовать надежный пароль (минимум 12 символов, буквы, цифры, символы)

## Troubleshooting

Если деплой не работает:
1. Проверьте логи сборки в Netlify Dashboard
2. Убедитесь, что Node.js версия совместима (в `netlify.toml` указана версия 20)
3. Проверьте, что все зависимости установлены
4. Убедитесь, что файл `netlify.toml` присутствует в корне проекта
5. Убедитесь, что все изменения закоммичены и запушены в GitHub

